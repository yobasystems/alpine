workflow:
  rules:
    - changes:
        - 'alpine-*/**'
        - 'Dockerfile'
        - 'LICENSE'
        - '.gitlab-ci.yml'
      when: always
    - when: never

stages:
  - build
  - test
  - deploy
  - manifest

include:
  - remote: https://gitlab.com/yobasystems/gitlab-ci-templates/raw/master/container_scanning_all_arch.yml
  - template: Jobs/Secret-Detection.gitlab-ci.yml
  - template: Jobs/SAST.gitlab-ci.yml

container_scanning_amd64:
  tags:
    - amd64
  variables:
    CS_DOCKERFILE_PATH: "alpine-3.23.0/amd64/Dockerfile"

container_scanning_armhf:
  tags:
    - aarch64 # Use aarch64 runner as there isnt an image for armhf
  variables:
    CS_DOCKERFILE_PATH: "alpine-3.23.0/arm32v7/Dockerfile"

container_scanning_aarch64:
  tags:
    - aarch64
  variables:
    CS_DOCKERFILE_PATH: "alpine-3.23.0/arm64v8/Dockerfile"

sbom_amd64:
  tags:
    - amd64

sbom_armhf:
  tags:
    - armhf

sbom_aarch64:
  tags:
    - aarch64

.build_job_template:
  image: yobasystems/alpine-docker:dind
  stage: build
  variables:
    CI_APPLICATION_REPOSITORY: "$CI_REGISTRY_IMAGE/$CI_COMMIT_REF_SLUG"
    CI_APPLICATION_TAG: "$CI_COMMIT_SHA"
  script:
    - export COMMIT_TIME=$(git show -s --format=%ct $CI_APPLICATION_TAG)
    - apk add --no-cache --update git
    - echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin
    - echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    - echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    - echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    - CD_PATH="alpine-${ALPINE_DIR_VERSION}/${BUILD_ARCH_DIR}/"
    - cd "$CD_PATH"
    - |
      DOCKER_BUILD_ARGS="--build-arg VCS_REF=${CI_COMMIT_SHORT_SHA} --build-arg BUILD_DATE=${COMMIT_TIME}"
      for TAG_SUFFIX in ${IMAGE_TAGS}; do
        DOCKER_BUILD_ARGS="$DOCKER_BUILD_ARGS -t $DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:$TAG_SUFFIX"
        DOCKER_BUILD_ARGS="$DOCKER_BUILD_ARGS -t $DOCKER_REGISTRY_DOCKERHUB_REPO:$TAG_SUFFIX"
        DOCKER_BUILD_ARGS="$DOCKER_BUILD_ARGS -t $DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:$TAG_SUFFIX"
        DOCKER_BUILD_ARGS="$DOCKER_BUILD_ARGS -t ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:$TAG_SUFFIX"
      done
      echo "Building image with platform ${PLATFORM} and tags:"
      # This echo is for readability in logs, actual tags are in DOCKER_BUILD_ARGS
      echo "$DOCKER_BUILD_ARGS"
      docker build ${DOCKER_BUILD_ARGS} --platform "${PLATFORM}" .
    - |
      echo "Pushing images..."
      for TAG_SUFFIX in ${IMAGE_TAGS}; do
        echo "Pushing $DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:$TAG_SUFFIX"
        docker push "$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:$TAG_SUFFIX"
        echo "Pushing $DOCKER_REGISTRY_DOCKERHUB_REPO:$TAG_SUFFIX"
        docker push "$DOCKER_REGISTRY_DOCKERHUB_REPO:$TAG_SUFFIX"
        echo "Pushing $DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:$TAG_SUFFIX"
        docker push "$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:$TAG_SUFFIX"
        echo "Pushing ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:$TAG_SUFFIX"
        docker push "ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:$TAG_SUFFIX"
      done

# Alpine 3.23.x builds (includes 'latest' tags)
build_alpine_3.23.0_amd64:
  extends: .build_job_template
  tags:
    - amd64
  variables:
    ALPINE_DIR_VERSION: "3.23.0"
    BUILD_ARCH_DIR: "amd64"
    IMAGE_TAGS: "latest x86_64 amd64 3.23.0-x86_64 3.23-x86_64 3.23.0-amd64 3.23-amd64"
    PLATFORM: "linux/amd64"

build_alpine_3.23.0_arm32v7:
  extends: .build_job_template
  tags:
    - armhf
  variables:
    ALPINE_DIR_VERSION: "3.23.0"
    BUILD_ARCH_DIR: "arm32v7"
    IMAGE_TAGS: "latest arm32v7 armhf 3.23.0-arm32v7 3.23-arm32v7 3.23.0-armhf 3.23-armhf"
    PLATFORM: "linux/arm/v7"

build_alpine_3.23.0_arm64v8:
  extends: .build_job_template
  tags:
    - aarch64
  variables:
    ALPINE_DIR_VERSION: "3.23.0"
    BUILD_ARCH_DIR: "arm64v8"
    IMAGE_TAGS: "latest arm64v8 aarch64 3.23.0-arm64v8 3.23-arm64v8 3.23.0-aarch64 3.23-aarch64"
    PLATFORM: "linux/arm64/v8"

# Alpine 3.22.x builds
build_alpine_3.22.2_amd64:
  extends: .build_job_template
  tags:
    - amd64
  variables:
    ALPINE_DIR_VERSION: "3.22.2"
    BUILD_ARCH_DIR: "amd64"
    IMAGE_TAGS: "3.22.2-x86_64 3.22-x86_64 3.22.2-amd64 3.22-amd64"
    PLATFORM: "linux/amd64"

build_alpine_3.22.2_arm32v7:
  extends: .build_job_template
  tags:
    - armhf
  variables:
    ALPINE_DIR_VERSION: "3.22.2"
    BUILD_ARCH_DIR: "arm32v7"
    IMAGE_TAGS: "3.22.2-arm32v7 3.22-arm32v7 3.22.2-armhf 3.22-armhf"
    PLATFORM: "linux/arm/v7"

build_alpine_3.22.2_arm64v8:
  extends: .build_job_template
  tags:
    - aarch64
  variables:
    ALPINE_DIR_VERSION: "3.22.2"
    BUILD_ARCH_DIR: "arm64v8"
    IMAGE_TAGS: "3.22.2-arm64v8 3.22-arm64v8 3.22.2-aarch64 3.22-aarch64"
    PLATFORM: "linux/arm64/v8"

# Alpine 3.21.x builds
build_alpine_3.21.5_amd64:
  extends: .build_job_template
  tags:
    - amd64
  variables:
    ALPINE_DIR_VERSION: "3.21.5"
    BUILD_ARCH_DIR: "amd64"
    IMAGE_TAGS: "3.21.5-x86_64 3.21-x86_64 3.21.5-amd64 3.21-amd64"
    PLATFORM: "linux/amd64"

build_alpine_3.21.5_arm32v7:
  extends: .build_job_template
  tags:
    - armhf
  variables:
    ALPINE_DIR_VERSION: "3.21.5"
    BUILD_ARCH_DIR: "arm32v7"
    IMAGE_TAGS: "3.21.5-arm32v7 3.21-arm32v7 3.21.5-armhf 3.21-armhf"
    PLATFORM: "linux/arm/v7"

build_alpine_3.21.5_arm64v8:
  extends: .build_job_template
  tags:
    - aarch64
  variables:
    ALPINE_DIR_VERSION: "3.21.5"
    BUILD_ARCH_DIR: "arm64v8"
    IMAGE_TAGS: "3.21.5-arm64v8 3.21-arm64v8 3.21.5-aarch64 3.21-aarch64"
    PLATFORM: "linux/arm64/v8"

# Alpine 3.20.x builds
build_alpine_3.20.8_amd64:
  extends: .build_job_template
  tags:
    - amd64
  variables:
    ALPINE_DIR_VERSION: "3.20.8"
    BUILD_ARCH_DIR: "amd64"
    IMAGE_TAGS: "3.20.8-x86_64 3.20-x86_64 3.20.8-amd64 3.20-amd64"
    PLATFORM: "linux/amd64"

build_alpine_3.20.8_arm32v7:
  extends: .build_job_template
  tags:
    - armhf
  variables:
    ALPINE_DIR_VERSION: "3.20.8"
    BUILD_ARCH_DIR: "arm32v7"
    IMAGE_TAGS: "3.20.8-arm32v7 3.20-arm32v7 3.20.8-armhf 3.20-armhf"
    PLATFORM: "linux/arm/v7"

build_alpine_3.20.8_arm64v8:
  extends: .build_job_template
  tags:
    - aarch64
  variables:
    ALPINE_DIR_VERSION: "3.20.8"
    BUILD_ARCH_DIR: "arm64v8"
    IMAGE_TAGS: "3.20.8-arm64v8 3.20-arm64v8 3.20.8-aarch64 3.20-aarch64"
    PLATFORM: "linux/arm64/v8"

# Alpine 3.19.x builds
build_alpine_3.19.9_amd64:
  extends: .build_job_template
  tags:
    - amd64
  variables:
    ALPINE_DIR_VERSION: "3.19.9"
    BUILD_ARCH_DIR: "amd64"
    IMAGE_TAGS: "3.19.9-x86_64 3.19-x86_64 3.19.9-amd64 3.19-amd64"
    PLATFORM: "linux/amd64"

build_alpine_3.19.9_arm32v7:
  extends: .build_job_template
  tags:
    - armhf
  variables:
    ALPINE_DIR_VERSION: "3.19.9"
    BUILD_ARCH_DIR: "arm32v7"
    IMAGE_TAGS: "3.19.9-arm32v7 3.19-arm32v7 3.19.9-armhf 3.19-armhf"
    PLATFORM: "linux/arm/v7"

build_alpine_3.19.9_arm64v8:
  extends: .build_job_template
  tags:
    - aarch64
  variables:
    ALPINE_DIR_VERSION: "3.19.9"
    BUILD_ARCH_DIR: "arm64v8"
    IMAGE_TAGS: "3.19.9-arm64v8 3.19-arm64v8 3.19.9-aarch64 3.19-aarch64"
    PLATFORM: "linux/arm64/v8"

.manifest_job_template_versioned:
  image: yobasystems/alpine-docker:dind
  stage: manifest
  tags:
    - manifest

manifest_creation_latest:
  image: yobasystems/alpine-docker:dind
  stage: manifest
  tags:
    - manifest
  needs:
    - container_scanning_amd64
    - container_scanning_armhf
    - container_scanning_aarch64
    - sbom_amd64
    - sbom_armhf
    - sbom_aarch64
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    GL_IMG_AMD64="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:amd64"
    GL_IMG_ARM32V7="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:arm32v7"
    GL_IMG_ARM64V8="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:arm64v8"
    # Define Docker Hub specific image names for 'latest'
    DH_IMG_AMD64="$DOCKER_REGISTRY_DOCKERHUB_REPO:amd64"
    DH_IMG_ARM32V7="$DOCKER_REGISTRY_DOCKERHUB_REPO:arm32v7"
    DH_IMG_ARM64V8="$DOCKER_REGISTRY_DOCKERHUB_REPO:arm64v8"
    # Define GHCR specific image names for 'latest'
    GHCR_IMG_AMD64="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:amd64"
    GHCR_IMG_ARM32V7="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:arm32v7"
    GHCR_IMG_ARM64V8="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:arm64v8"
    # Define Quay.io specific image names for 'latest'
    QUAY_IMG_AMD64="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:amd64"
    QUAY_IMG_ARM32V7="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:arm32v7"
    QUAY_IMG_ARM64V8="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin
    echo "INFO: Pulling base architecture images from GitLab Registry for latest tag..."
    docker pull "$GL_IMG_AMD64"
    docker pull "$GL_IMG_ARM32V7"
    docker pull "$GL_IMG_ARM64V8"

    echo "INFO: Processing GitLab manifest for latest..."
    MANIFEST_LIST_GITLAB="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:latest"
    docker manifest create "$MANIFEST_LIST_GITLAB" "$GL_IMG_AMD64" "$GL_IMG_ARM32V7" "$GL_IMG_ARM64V8"
    docker manifest annotate "$MANIFEST_LIST_GITLAB" "$GL_IMG_AMD64" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB" "$GL_IMG_ARM32V7" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB" "$GL_IMG_ARM64V8" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB"

    echo "INFO: Processing Docker Hub manifest for latest..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB="$DOCKER_REGISTRY_DOCKERHUB_REPO:latest"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB" "$DH_IMG_AMD64" "$DH_IMG_ARM32V7" "$DH_IMG_ARM64V8"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB" "$DH_IMG_AMD64" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB" "$DH_IMG_ARM32V7" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB" "$DH_IMG_ARM64V8" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB"

    echo "INFO: Processing GHCR manifest for latest..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:latest"
    docker manifest create "$MANIFEST_LIST_GHCR" "$GHCR_IMG_AMD64" "$GHCR_IMG_ARM32V7" "$GHCR_IMG_ARM64V8"
    docker manifest annotate "$MANIFEST_LIST_GHCR" "$GHCR_IMG_AMD64" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR" "$GHCR_IMG_ARM32V7" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR" "$GHCR_IMG_ARM64V8" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR"

    echo "INFO: Processing Quay.io manifest for latest..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:latest"
    docker manifest create "$MANIFEST_LIST_QUAY" "$QUAY_IMG_AMD64" "$QUAY_IMG_ARM32V7" "$QUAY_IMG_ARM64V8"
    docker manifest annotate "$MANIFEST_LIST_QUAY" "$QUAY_IMG_AMD64" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY" "$QUAY_IMG_ARM32V7" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY" "$QUAY_IMG_ARM64V8" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY"

manifest_creation_3.23.x:
  extends: .manifest_job_template_versioned
  needs:
    - build_alpine_3.23.0_amd64
    - build_alpine_3.23.0_arm32v7
    - build_alpine_3.23.0_arm64v8
  variables:
    ALPINE_VERSION_FULL: "3.23.0"
    ALPINE_VERSION_MINOR: "3.23"
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    # Define ALL architecture-specific image names for GitLab, DockerHub, GHCR, Quay.io
    # For FULL version (${ALPINE_VERSION_FULL})
    GL_IMG_AMD64_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-amd64"
    GL_IMG_ARM32V7_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GL_IMG_ARM64V8_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    DH_IMG_AMD64_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-amd64"
    DH_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    DH_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    GHCR_IMG_AMD64_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-amd64"
    GHCR_IMG_ARM32V7_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GHCR_IMG_ARM64V8_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    QUAY_IMG_AMD64_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-amd64"
    QUAY_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    QUAY_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm64v8"

    # For MINOR version (${ALPINE_VERSION_MINOR})
    GL_IMG_AMD64_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GL_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GL_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    DH_IMG_AMD64_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-amd64"
    DH_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    DH_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    GHCR_IMG_AMD64_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GHCR_IMG_ARM32V7_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GHCR_IMG_ARM64V8_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    QUAY_IMG_AMD64_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    QUAY_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    QUAY_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin

    # --- Processing for ${ALPINE_VERSION_FULL} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_FULL} tag..."
    docker pull "$GL_IMG_AMD64_FULL"
    docker pull "$GL_IMG_ARM32V7_FULL"
    docker pull "$GL_IMG_ARM64V8_FULL"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_FULL}..."
    MANIFEST_LIST_GITLAB_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" "$GL_IMG_ARM32V7_FULL" "$GL_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_FULL"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_FULL}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" "$DH_IMG_ARM32V7_FULL" "$DH_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_FULL"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_FULL}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" "$GHCR_IMG_ARM32V7_FULL" "$GHCR_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_FULL"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_FULL}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" "$QUAY_IMG_ARM32V7_FULL" "$QUAY_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_FULL"

    # --- Processing for ${ALPINE_VERSION_MINOR} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_MINOR} tag..."
    docker pull "$GL_IMG_AMD64_MINOR"
    docker pull "$GL_IMG_ARM32V7_MINOR"
    docker pull "$GL_IMG_ARM64V8_MINOR"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_MINOR}..."
    MANIFEST_LIST_GITLAB_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" "$GL_IMG_ARM32V7_MINOR" "$GL_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_MINOR"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" "$DH_IMG_ARM32V7_MINOR" "$DH_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_MINOR"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" "$GHCR_IMG_ARM32V7_MINOR" "$GHCR_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_MINOR"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" "$QUAY_IMG_ARM32V7_MINOR" "$QUAY_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_MINOR"

manifest_creation_3.22.x:
  extends: .manifest_job_template_versioned
  needs:
    - build_alpine_3.22.2_amd64
    - build_alpine_3.22.2_arm32v7
    - build_alpine_3.22.2_arm64v8
  variables:
    ALPINE_VERSION_FULL: "3.22.2"
    ALPINE_VERSION_MINOR: "3.22"
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    # Define ALL architecture-specific image names for GitLab, DockerHub, GHCR, Quay.io
    # For FULL version (${ALPINE_VERSION_FULL})
    GL_IMG_AMD64_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-amd64"
    GL_IMG_ARM32V7_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GL_IMG_ARM64V8_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    DH_IMG_AMD64_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-amd64"
    DH_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    DH_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    GHCR_IMG_AMD64_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-amd64"
    GHCR_IMG_ARM32V7_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GHCR_IMG_ARM64V8_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    QUAY_IMG_AMD64_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-amd64"
    QUAY_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    QUAY_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm64v8"

    # For MINOR version (${ALPINE_VERSION_MINOR})
    GL_IMG_AMD64_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GL_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GL_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    DH_IMG_AMD64_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-amd64"
    DH_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    DH_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    GHCR_IMG_AMD64_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GHCR_IMG_ARM32V7_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GHCR_IMG_ARM64V8_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    QUAY_IMG_AMD64_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    QUAY_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    QUAY_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin

    # --- Processing for ${ALPINE_VERSION_FULL} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_FULL} tag..."
    docker pull "$GL_IMG_AMD64_FULL"
    docker pull "$GL_IMG_ARM32V7_FULL"
    docker pull "$GL_IMG_ARM64V8_FULL"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_FULL}..."
    MANIFEST_LIST_GITLAB_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" "$GL_IMG_ARM32V7_FULL" "$GL_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_FULL"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_FULL}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" "$DH_IMG_ARM32V7_FULL" "$DH_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_FULL"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_FULL}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" "$GHCR_IMG_ARM32V7_FULL" "$GHCR_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_FULL"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_FULL}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" "$QUAY_IMG_ARM32V7_FULL" "$QUAY_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_FULL"

    # --- Processing for ${ALPINE_VERSION_MINOR} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_MINOR} tag..."
    docker pull "$GL_IMG_AMD64_MINOR"
    docker pull "$GL_IMG_ARM32V7_MINOR"
    docker pull "$GL_IMG_ARM64V8_MINOR"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_MINOR}..."
    MANIFEST_LIST_GITLAB_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" "$GL_IMG_ARM32V7_MINOR" "$GL_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_MINOR"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" "$DH_IMG_ARM32V7_MINOR" "$DH_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_MINOR"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" "$GHCR_IMG_ARM32V7_MINOR" "$GHCR_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_MINOR"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" "$QUAY_IMG_ARM32V7_MINOR" "$QUAY_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_MINOR"

manifest_creation_3.21.x:
  extends: .manifest_job_template_versioned
  needs:
    - build_alpine_3.21.5_amd64
    - build_alpine_3.21.5_arm32v7
    - build_alpine_3.21.5_arm64v8
  variables:
    ALPINE_VERSION_FULL: "3.21.5"
    ALPINE_VERSION_MINOR: "3.21"
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    # Define ALL architecture-specific image names for GitLab, DockerHub, GHCR, Quay.io
    # For FULL version (${ALPINE_VERSION_FULL})
    GL_IMG_AMD64_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-amd64"
    GL_IMG_ARM32V7_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GL_IMG_ARM64V8_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    DH_IMG_AMD64_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-amd64"
    DH_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    DH_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    GHCR_IMG_AMD64_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-amd64"
    GHCR_IMG_ARM32V7_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GHCR_IMG_ARM64V8_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    QUAY_IMG_AMD64_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-amd64"
    QUAY_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    QUAY_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm64v8"

    # For MINOR version (${ALPINE_VERSION_MINOR})
    GL_IMG_AMD64_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GL_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GL_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    DH_IMG_AMD64_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-amd64"
    DH_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    DH_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    GHCR_IMG_AMD64_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GHCR_IMG_ARM32V7_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GHCR_IMG_ARM64V8_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    QUAY_IMG_AMD64_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    QUAY_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    QUAY_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin

    # --- Processing for ${ALPINE_VERSION_FULL} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_FULL} tag..."
    docker pull "$GL_IMG_AMD64_FULL"
    docker pull "$GL_IMG_ARM32V7_FULL"
    docker pull "$GL_IMG_ARM64V8_FULL"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_FULL}..."
    MANIFEST_LIST_GITLAB_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" "$GL_IMG_ARM32V7_FULL" "$GL_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_FULL"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_FULL}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" "$DH_IMG_ARM32V7_FULL" "$DH_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_FULL"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_FULL}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" "$GHCR_IMG_ARM32V7_FULL" "$GHCR_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_FULL"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_FULL}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" "$QUAY_IMG_ARM32V7_FULL" "$QUAY_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_FULL"

    # --- Processing for ${ALPINE_VERSION_MINOR} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_MINOR} tag..."
    docker pull "$GL_IMG_AMD64_MINOR"
    docker pull "$GL_IMG_ARM32V7_MINOR"
    docker pull "$GL_IMG_ARM64V8_MINOR"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_MINOR}..."
    MANIFEST_LIST_GITLAB_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" "$GL_IMG_ARM32V7_MINOR" "$GL_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_MINOR"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" "$DH_IMG_ARM32V7_MINOR" "$DH_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_MINOR"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" "$GHCR_IMG_ARM32V7_MINOR" "$GHCR_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_MINOR"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" "$QUAY_IMG_ARM32V7_MINOR" "$QUAY_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_MINOR"

manifest_creation_3.20.x:
  extends: .manifest_job_template_versioned
  needs:
    - build_alpine_3.20.8_amd64
    - build_alpine_3.20.8_arm32v7
    - build_alpine_3.20.8_arm64v8
  variables:
    ALPINE_VERSION_FULL: "3.20.8"
    ALPINE_VERSION_MINOR: "3.20"
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    # Define ALL architecture-specific image names for GitLab, DockerHub, GHCR, Quay.io
    # For FULL version (${ALPINE_VERSION_FULL})
    GL_IMG_AMD64_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-amd64"
    GL_IMG_ARM32V7_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GL_IMG_ARM64V8_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    DH_IMG_AMD64_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-amd64"
    DH_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    DH_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    GHCR_IMG_AMD64_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-amd64"
    GHCR_IMG_ARM32V7_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GHCR_IMG_ARM64V8_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    QUAY_IMG_AMD64_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-amd64"
    QUAY_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    QUAY_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm64v8"

    # For MINOR version (${ALPINE_VERSION_MINOR})
    GL_IMG_AMD64_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GL_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GL_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    DH_IMG_AMD64_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-amd64"
    DH_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    DH_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    GHCR_IMG_AMD64_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GHCR_IMG_ARM32V7_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GHCR_IMG_ARM64V8_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    QUAY_IMG_AMD64_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    QUAY_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    QUAY_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin

    # --- Processing for ${ALPINE_VERSION_FULL} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_FULL} tag..."
    docker pull "$GL_IMG_AMD64_FULL"
    docker pull "$GL_IMG_ARM32V7_FULL"
    docker pull "$GL_IMG_ARM64V8_FULL"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_FULL}..."
    MANIFEST_LIST_GITLAB_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" "$GL_IMG_ARM32V7_FULL" "$GL_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_FULL"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_FULL}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" "$DH_IMG_ARM32V7_FULL" "$DH_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_FULL"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_FULL}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" "$GHCR_IMG_ARM32V7_FULL" "$GHCR_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_FULL"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_FULL}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" "$QUAY_IMG_ARM32V7_FULL" "$QUAY_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_FULL"

    # --- Processing for ${ALPINE_VERSION_MINOR} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_MINOR} tag..."
    docker pull "$GL_IMG_AMD64_MINOR"
    docker pull "$GL_IMG_ARM32V7_MINOR"
    docker pull "$GL_IMG_ARM64V8_MINOR"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_MINOR}..."
    MANIFEST_LIST_GITLAB_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" "$GL_IMG_ARM32V7_MINOR" "$GL_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_MINOR"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" "$DH_IMG_ARM32V7_MINOR" "$DH_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_MINOR"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" "$GHCR_IMG_ARM32V7_MINOR" "$GHCR_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_MINOR"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" "$QUAY_IMG_ARM32V7_MINOR" "$QUAY_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_MINOR"

manifest_creation_3.19.x:
  extends: .manifest_job_template_versioned
  needs:
    - build_alpine_3.19.9_amd64
    - build_alpine_3.19.9_arm32v7
    - build_alpine_3.19.9_arm64v8
  variables:
    ALPINE_VERSION_FULL: "3.19.9"
    ALPINE_VERSION_MINOR: "3.19"
  script: |
    set -e
    mkdir -p /root/.docker
    echo -e "{\n    \"experimental\": \"enabled\"\n}\n" >> ~/.docker/config.json

    # Define ALL architecture-specific image names for GitLab, DockerHub, GHCR, Quay.io
    # For FULL version (${ALPINE_VERSION_FULL})
    GL_IMG_AMD64_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-amd64"
    GL_IMG_ARM32V7_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GL_IMG_ARM64V8_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    DH_IMG_AMD64_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-amd64"
    DH_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    DH_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    GHCR_IMG_AMD64_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-amd64"
    GHCR_IMG_ARM32V7_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    GHCR_IMG_ARM64V8_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}-arm64v8"
    QUAY_IMG_AMD64_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-amd64"
    QUAY_IMG_ARM32V7_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm32v7"
    QUAY_IMG_ARM64V8_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}-arm64v8"

    # For MINOR version (${ALPINE_VERSION_MINOR})
    GL_IMG_AMD64_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GL_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GL_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    DH_IMG_AMD64_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-amd64"
    DH_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    DH_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    GHCR_IMG_AMD64_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-amd64"
    GHCR_IMG_ARM32V7_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    GHCR_IMG_ARM64V8_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}-arm64v8"
    QUAY_IMG_AMD64_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-amd64"
    QUAY_IMG_ARM32V7_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm32v7"
    QUAY_IMG_ARM64V8_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}-arm64v8"

    echo "INFO: Logging into GitLab Registry ($DOCKER_REGISTRY)..."
    echo "$CI_JOB_TOKEN" | docker login -u gitlab-ci-token "$DOCKER_REGISTRY" --password-stdin

    # --- Processing for ${ALPINE_VERSION_FULL} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_FULL} tag..."
    docker pull "$GL_IMG_AMD64_FULL"
    docker pull "$GL_IMG_ARM32V7_FULL"
    docker pull "$GL_IMG_ARM64V8_FULL"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_FULL}..."
    MANIFEST_LIST_GITLAB_FULL="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" "$GL_IMG_ARM32V7_FULL" "$GL_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_FULL" "$GL_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_FULL"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_FULL}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_FULL="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" "$DH_IMG_ARM32V7_FULL" "$DH_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_FULL" "$DH_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_FULL"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_FULL}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_FULL="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" "$GHCR_IMG_ARM32V7_FULL" "$GHCR_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_FULL" "$GHCR_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_FULL"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_FULL}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_FULL="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_FULL}"
    docker manifest create "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" "$QUAY_IMG_ARM32V7_FULL" "$QUAY_IMG_ARM64V8_FULL"
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_AMD64_FULL" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM32V7_FULL" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_FULL" "$QUAY_IMG_ARM64V8_FULL" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_FULL"

    # --- Processing for ${ALPINE_VERSION_MINOR} ---
    echo "INFO: Pulling base architecture images from GitLab Registry for ${ALPINE_VERSION_MINOR} tag..."
    docker pull "$GL_IMG_AMD64_MINOR"
    docker pull "$GL_IMG_ARM32V7_MINOR"
    docker pull "$GL_IMG_ARM64V8_MINOR"

    echo "INFO: Processing GitLab manifest for ${ALPINE_VERSION_MINOR}..."
    MANIFEST_LIST_GITLAB_MINOR="$DOCKER_REGISTRY/$DOCKER_REGISTRY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" "$GL_IMG_ARM32V7_MINOR" "$GL_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GITLAB_MINOR" "$GL_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GITLAB_MINOR"

    echo "INFO: Processing Docker Hub manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    MANIFEST_LIST_DOCKERHUB_MINOR="$DOCKER_REGISTRY_DOCKERHUB_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" "$DH_IMG_ARM32V7_MINOR" "$DH_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_DOCKERHUB_MINOR" "$DH_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_DOCKERHUB_MINOR"

    echo "INFO: Processing GHCR manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$GITHUB_TOKEN" | docker login -u "$GITHUB_USERNAME" ghcr.io --password-stdin
    MANIFEST_LIST_GHCR_MINOR="ghcr.io/$DOCKER_REGISTRY_GHCR_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" "$GHCR_IMG_ARM32V7_MINOR" "$GHCR_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_GHCR_MINOR" "$GHCR_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_GHCR_MINOR"

    echo "INFO: Processing Quay.io manifest for ${ALPINE_VERSION_MINOR}..."
    echo "$QUAY_PASSWORD" | docker login -u "$QUAY_USERNAME" quay.io --password-stdin
    MANIFEST_LIST_QUAY_MINOR="$DOCKER_REGISTRY_QUAY/$DOCKER_REGISTRY_QUAY_REPO:${ALPINE_VERSION_MINOR}"
    docker manifest create "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" "$QUAY_IMG_ARM32V7_MINOR" "$QUAY_IMG_ARM64V8_MINOR"
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_AMD64_MINOR" --os linux --arch amd64
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM32V7_MINOR" --os linux --arch arm --variant 7
    docker manifest annotate "$MANIFEST_LIST_QUAY_MINOR" "$QUAY_IMG_ARM64V8_MINOR" --os linux --arch arm64 --variant 8
    docker manifest push "$MANIFEST_LIST_QUAY_MINOR"
